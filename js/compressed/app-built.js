$(function(){var requirejs,require,define;!function(t){function e(t,e){return v.call(t,e)}function n(t,e){var n,r,i,o,a,s,u,c,l,f,h=e&&e.split("/"),d=g.map,p=d&&d["*"]||{};if(t&&"."===t.charAt(0))if(e){for(h=h.slice(0,h.length-1),t=h.concat(t.split("/")),c=0;c<t.length;c+=1)if(f=t[c],"."===f)t.splice(c,1),c-=1;else if(".."===f){if(1===c&&(".."===t[2]||".."===t[0]))break;c>0&&(t.splice(c-1,2),c-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((h||p)&&d){for(n=t.split("/"),c=n.length;c>0;c-=1){if(r=n.slice(0,c).join("/"),h)for(l=h.length;l>0;l-=1)if(i=d[h.slice(0,l).join("/")],i&&(i=i[r])){o=i,a=c;break}if(o)break;!s&&p&&p[r]&&(s=p[r],u=c)}!o&&s&&(o=s,a=u),o&&(n.splice(0,a,o),t=n.join("/"))}return t}function r(e,n){return function(){return l.apply(t,y.call(arguments,0).concat([e,n]))}}function i(t){return function(e){return n(e,t)}}function o(t){return function(e){d[t]=e}}function a(n){if(e(p,n)){var r=p[n];delete p[n],m[n]=!0,c.apply(t,r)}if(!e(d,n)&&!e(m,n))throw new Error("No "+n);return d[n]}function s(t){var e,n=t?t.indexOf("!"):-1;return n>-1&&(e=t.substring(0,n),t=t.substring(n+1,t.length)),[e,t]}function u(t){return function(){return g&&g.config&&g.config[t]||{}}}var c,l,f,h,d={},p={},g={},m={},v=Object.prototype.hasOwnProperty,y=[].slice;f=function(t,e){var r,o=s(t),u=o[0];return t=o[1],u&&(u=n(u,e),r=a(u)),u?t=r&&r.normalize?r.normalize(t,i(e)):n(t,e):(t=n(t,e),o=s(t),u=o[0],t=o[1],u&&(r=a(u))),{f:u?u+"!"+t:t,n:t,pr:u,p:r}},h={require:function(t){return r(t)},exports:function(t){var e=d[t];return"undefined"!=typeof e?e:d[t]={}},module:function(t){return{id:t,uri:"",exports:d[t],config:u(t)}}},c=function(n,i,s,u){var c,l,g,v,y,b,w=[];if(u=u||n,"function"==typeof s){for(i=!i.length&&s.length?["require","exports","module"]:i,y=0;y<i.length;y+=1)if(v=f(i[y],u),l=v.f,"require"===l)w[y]=h.require(n);else if("exports"===l)w[y]=h.exports(n),b=!0;else if("module"===l)c=w[y]=h.module(n);else if(e(d,l)||e(p,l)||e(m,l))w[y]=a(l);else{if(!v.p)throw new Error(n+" missing "+l);v.p.load(v.n,r(u,!0),o(l),{}),w[y]=d[l]}g=s.apply(d[n],w),n&&(c&&c.exports!==t&&c.exports!==d[n]?d[n]=c.exports:g===t&&b||(d[n]=g))}else n&&(d[n]=s)},requirejs=require=l=function(e,n,r,i,o){return"string"==typeof e?h[e]?h[e](n):a(f(e,n).f):(e.splice||(g=e,n.splice?(e=n,n=r,r=null):e=t),n=n||function(){},"function"==typeof r&&(r=i,i=o),i?c(t,e,n,r):setTimeout(function(){c(t,e,n,r)},4),l)},l.config=function(t){return g=t,g.deps&&l(g.deps,g.callback),l},define=function(t,n,r){n.splice||(r=n,n=[]),e(d,t)||e(p,t)||(p[t]=[t,n,r])},define.amd={jQuery:!0}}(),define("libs/almond/almond.js",function(){}),define("jQuery",[],function(){return window.jQuery}),function(){function t(e,n,r){if(e===n)return 0!==e||1/e==1/n;if(null==e||null==n)return e===n;if(e._chain&&(e=e._wrapped),n._chain&&(n=n._wrapped),e.isEqual&&_.isFunction(e.isEqual))return e.isEqual(n);if(n.isEqual&&_.isFunction(n.isEqual))return n.isEqual(e);var i=u.call(e);if(i!=u.call(n))return!1;switch(i){case"[object String]":return e==""+n;case"[object Number]":return e!=+e?n!=+n:0==e?1/e==1/n:e==+n;case"[object Date]":case"[object Boolean]":return+e==+n;case"[object RegExp]":return e.source==n.source&&e.global==n.global&&e.multiline==n.multiline&&e.ignoreCase==n.ignoreCase}if("object"!=typeof e||"object"!=typeof n)return!1;for(var o=r.length;o--;)if(r[o]==e)return!0;r.push(e);var o=0,a=!0;if("[object Array]"==i){if(o=e.length,a=o==n.length)for(;o--&&(a=o in e==o in n&&t(e[o],n[o],r)););}else{if("constructor"in e!="constructor"in n||e.constructor!=n.constructor)return!1;for(var s in e)if(_.has(e,s)&&(o++,!(a=_.has(n,s)&&t(e[s],n[s],r))))break;if(a){for(s in n)if(_.has(n,s)&&!o--)break;a=!o}}return r.pop(),a}var e=this,n=e._,r={},i=Array.prototype,o=Object.prototype,a=i.slice,s=i.unshift,u=o.toString,c=o.hasOwnProperty,l=i.forEach,f=i.map,h=i.reduce,d=i.reduceRight,p=i.filter,g=i.every,m=i.some,v=i.indexOf,y=i.lastIndexOf,o=Array.isArray,b=Object.keys,w=Function.prototype.bind,_=function(t){return new M(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=_),exports._=_):e._=_,_.VERSION="1.3.3";var x=_.each=_.forEach=function(t,e,n){if(null!=t)if(l&&t.forEach===l)t.forEach(e,n);else if(t.length===+t.length)for(var i=0,o=t.length;o>i&&!(i in t&&e.call(n,t[i],i,t)===r);i++);else for(i in t)if(_.has(t,i)&&e.call(n,t[i],i,t)===r)break};_.map=_.collect=function(t,e,n){var r=[];return null==t?r:f&&t.map===f?t.map(e,n):(x(t,function(t,i,o){r[r.length]=e.call(n,t,i,o)}),t.length===+t.length&&(r.length=t.length),r)},_.reduce=_.foldl=_.inject=function(t,e,n,r){var i=arguments.length>2;if(null==t&&(t=[]),h&&t.reduce===h)return r&&(e=_.bind(e,r)),i?t.reduce(e,n):t.reduce(e);if(x(t,function(t,o,a){i?n=e.call(r,n,t,o,a):(n=t,i=!0)}),!i)throw new TypeError("Reduce of empty array with no initial value");return n},_.reduceRight=_.foldr=function(t,e,n,r){var i=arguments.length>2;if(null==t&&(t=[]),d&&t.reduceRight===d)return r&&(e=_.bind(e,r)),i?t.reduceRight(e,n):t.reduceRight(e);var o=_.toArray(t).reverse();return r&&!i&&(e=_.bind(e,r)),i?_.reduce(o,e,n,r):_.reduce(o,e)},_.find=_.detect=function(t,e,n){var r;return S(t,function(t,i,o){return e.call(n,t,i,o)?(r=t,!0):void 0}),r},_.filter=_.select=function(t,e,n){var r=[];return null==t?r:p&&t.filter===p?t.filter(e,n):(x(t,function(t,i,o){e.call(n,t,i,o)&&(r[r.length]=t)}),r)},_.reject=function(t,e,n){var r=[];return null==t?r:(x(t,function(t,i,o){e.call(n,t,i,o)||(r[r.length]=t)}),r)},_.every=_.all=function(t,e,n){var i=!0;return null==t?i:g&&t.every===g?t.every(e,n):(x(t,function(t,o,a){return(i=i&&e.call(n,t,o,a))?void 0:r}),!!i)};var S=_.some=_.any=function(t,e,n){e||(e=_.identity);var i=!1;return null==t?i:m&&t.some===m?t.some(e,n):(x(t,function(t,o,a){return i||(i=e.call(n,t,o,a))?r:void 0}),!!i)};_.include=_.contains=function(t,e){var n=!1;return null==t?n:v&&t.indexOf===v?-1!=t.indexOf(e):n=S(t,function(t){return t===e})},_.invoke=function(t,e){var n=a.call(arguments,2);return _.map(t,function(t){return(_.isFunction(e)?e||t:t[e]).apply(t,n)})},_.pluck=function(t,e){return _.map(t,function(t){return t[e]})},_.max=function(t,e,n){if(!e&&_.isArray(t)&&t[0]===+t[0])return Math.max.apply(Math,t);if(!e&&_.isEmpty(t))return-1/0;var r={computed:-1/0};return x(t,function(t,i,o){i=e?e.call(n,t,i,o):t,i>=r.computed&&(r={value:t,computed:i})}),r.value},_.min=function(t,e,n){if(!e&&_.isArray(t)&&t[0]===+t[0])return Math.min.apply(Math,t);if(!e&&_.isEmpty(t))return 1/0;var r={computed:1/0};return x(t,function(t,i,o){i=e?e.call(n,t,i,o):t,i<r.computed&&(r={value:t,computed:i})}),r.value},_.shuffle=function(t){var e,n=[];return x(t,function(t,r){e=Math.floor(Math.random()*(r+1)),n[r]=n[e],n[e]=t}),n},_.sortBy=function(t,e,n){var r=_.isFunction(e)?e:function(t){return t[e]};return _.pluck(_.map(t,function(t,e,i){return{value:t,criteria:r.call(n,t,e,i)}}).sort(function(t,e){var n=t.criteria,r=e.criteria;return void 0===n?1:void 0===r?-1:r>n?-1:n>r?1:0}),"value")},_.groupBy=function(t,e){var n={},r=_.isFunction(e)?e:function(t){return t[e]};return x(t,function(t,e){var i=r(t,e);(n[i]||(n[i]=[])).push(t)}),n},_.sortedIndex=function(t,e,n){n||(n=_.identity);for(var r=0,i=t.length;i>r;){var o=r+i>>1;n(t[o])<n(e)?r=o+1:i=o}return r},_.toArray=function(t){return t?_.isArray(t)||_.isArguments(t)?a.call(t):t.toArray&&_.isFunction(t.toArray)?t.toArray():_.values(t):[]},_.size=function(t){return _.isArray(t)?t.length:_.keys(t).length},_.first=_.head=_.take=function(t,e,n){return null==e||n?t[0]:a.call(t,0,e)},_.initial=function(t,e,n){return a.call(t,0,t.length-(null==e||n?1:e))},_.last=function(t,e,n){return null==e||n?t[t.length-1]:a.call(t,Math.max(t.length-e,0))},_.rest=_.tail=function(t,e,n){return a.call(t,null==e||n?1:e)},_.compact=function(t){return _.filter(t,function(t){return!!t})},_.flatten=function(t,e){return _.reduce(t,function(t,n){return _.isArray(n)?t.concat(e?n:_.flatten(n)):(t[t.length]=n,t)},[])},_.without=function(t){return _.difference(t,a.call(arguments,1))},_.uniq=_.unique=function(t,e,n){var n=n?_.map(t,n):t,r=[];return t.length<3&&(e=!0),_.reduce(n,function(n,i,o){return(e?_.last(n)===i&&n.length:_.include(n,i))||(n.push(i),r.push(t[o])),n},[]),r},_.union=function(){return _.uniq(_.flatten(arguments,!0))},_.intersection=_.intersect=function(t){var e=a.call(arguments,1);return _.filter(_.uniq(t),function(t){return _.every(e,function(e){return _.indexOf(e,t)>=0})})},_.difference=function(t){var e=_.flatten(a.call(arguments,1),!0);return _.filter(t,function(t){return!_.include(e,t)})},_.zip=function(){for(var t=a.call(arguments),e=_.max(_.pluck(t,"length")),n=Array(e),r=0;e>r;r++)n[r]=_.pluck(t,""+r);return n},_.indexOf=function(t,e,n){if(null==t)return-1;var r;if(n)return n=_.sortedIndex(t,e),t[n]===e?n:-1;if(v&&t.indexOf===v)return t.indexOf(e);for(n=0,r=t.length;r>n;n++)if(n in t&&t[n]===e)return n;return-1},_.lastIndexOf=function(t,e){if(null==t)return-1;if(y&&t.lastIndexOf===y)return t.lastIndexOf(e);for(var n=t.length;n--;)if(n in t&&t[n]===e)return n;return-1},_.range=function(t,e,n){arguments.length<=1&&(e=t||0,t=0);for(var n=arguments[2]||1,r=Math.max(Math.ceil((e-t)/n),0),i=0,o=Array(r);r>i;)o[i++]=t,t+=n;return o};var k=function(){};_.bind=function(t,e){var n,r;if(t.bind===w&&w)return w.apply(t,a.call(arguments,1));if(!_.isFunction(t))throw new TypeError;return r=a.call(arguments,2),n=function(){if(!(this instanceof n))return t.apply(e,r.concat(a.call(arguments)));k.prototype=t.prototype;var i=new k,o=t.apply(i,r.concat(a.call(arguments)));return Object(o)===o?o:i}},_.bindAll=function(t){var e=a.call(arguments,1);return 0==e.length&&(e=_.functions(t)),x(e,function(e){t[e]=_.bind(t[e],t)}),t},_.memoize=function(t,e){var n={};return e||(e=_.identity),function(){var r=e.apply(this,arguments);return _.has(n,r)?n[r]:n[r]=t.apply(this,arguments)}},_.delay=function(t,e){var n=a.call(arguments,2);return setTimeout(function(){return t.apply(null,n)},e)},_.defer=function(t){return _.delay.apply(_,[t,1].concat(a.call(arguments,1)))},_.throttle=function(t,e){var n,r,i,o,a,s,u=_.debounce(function(){a=o=!1},e);return function(){return n=this,r=arguments,i||(i=setTimeout(function(){i=null,a&&t.apply(n,r),u()},e)),o?a=!0:s=t.apply(n,r),u(),o=!0,s}},_.debounce=function(t,e,n){var r;return function(){var i=this,o=arguments;n&&!r&&t.apply(i,o),clearTimeout(r),r=setTimeout(function(){r=null,n||t.apply(i,o)},e)}},_.once=function(t){var e,n=!1;return function(){return n?e:(n=!0,e=t.apply(this,arguments))}},_.wrap=function(t,e){return function(){var n=[t].concat(a.call(arguments,0));return e.apply(this,n)}},_.compose=function(){var t=arguments;return function(){for(var e=arguments,n=t.length-1;n>=0;n--)e=[t[n].apply(this,e)];return e[0]}},_.after=function(t,e){return 0>=t?e():function(){return--t<1?e.apply(this,arguments):void 0}},_.keys=b||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e,n=[];for(e in t)_.has(t,e)&&(n[n.length]=e);return n},_.values=function(t){return _.map(t,_.identity)},_.functions=_.methods=function(t){var e,n=[];for(e in t)_.isFunction(t[e])&&n.push(e);return n.sort()},_.extend=function(t){return x(a.call(arguments,1),function(e){for(var n in e)t[n]=e[n]}),t},_.pick=function(t){var e={};return x(_.flatten(a.call(arguments,1)),function(n){n in t&&(e[n]=t[n])}),e},_.defaults=function(t){return x(a.call(arguments,1),function(e){for(var n in e)null==t[n]&&(t[n]=e[n])}),t},_.clone=function(t){return _.isObject(t)?_.isArray(t)?t.slice():_.extend({},t):t},_.tap=function(t,e){return e(t),t},_.isEqual=function(e,n){return t(e,n,[])},_.isEmpty=function(t){if(null==t)return!0;if(_.isArray(t)||_.isString(t))return 0===t.length;for(var e in t)if(_.has(t,e))return!1;return!0},_.isElement=function(t){return!(!t||1!=t.nodeType)},_.isArray=o||function(t){return"[object Array]"==u.call(t)},_.isObject=function(t){return t===Object(t)},_.isArguments=function(t){return"[object Arguments]"==u.call(t)},_.isArguments(arguments)||(_.isArguments=function(t){return!(!t||!_.has(t,"callee"))}),_.isFunction=function(t){return"[object Function]"==u.call(t)},_.isString=function(t){return"[object String]"==u.call(t)},_.isNumber=function(t){return"[object Number]"==u.call(t)},_.isFinite=function(t){return _.isNumber(t)&&isFinite(t)},_.isNaN=function(t){return t!==t},_.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"==u.call(t)},_.isDate=function(t){return"[object Date]"==u.call(t)},_.isRegExp=function(t){return"[object RegExp]"==u.call(t)},_.isNull=function(t){return null===t},_.isUndefined=function(t){return void 0===t},_.has=function(t,e){return c.call(t,e)},_.noConflict=function(){return e._=n,this},_.identity=function(t){return t},_.times=function(t,e,n){for(var r=0;t>r;r++)e.call(n,r)},_.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},_.result=function(t,e){if(null==t)return null;var n=t[e];return _.isFunction(n)?n.call(t):n},_.mixin=function(t){x(_.functions(t),function(e){N(e,_[e]=t[e])})};var E=0;_.uniqueId=function(t){var e=E++;return t?t+e:e},_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var j,F=/.^/,A={"\\":"\\","'":"'",r:"\r",n:"\n",t:"	",u2028:"\u2028",u2029:"\u2029"};for(j in A)A[A[j]]=j;var O=/\\|'|\r|\n|\t|\u2028|\u2029/g,B=/\\(\\|'|r|n|t|u2028|u2029)/g,q=function(t){return t.replace(B,function(t,e){return A[e]})};_.template=function(t,e,n){n=_.defaults(n||{},_.templateSettings),t="__p+='"+t.replace(O,function(t){return"\\"+A[t]}).replace(n.escape||F,function(t,e){return"'+\n_.escape("+q(e)+")+\n'"}).replace(n.interpolate||F,function(t,e){return"'+\n("+q(e)+")+\n'"}).replace(n.evaluate||F,function(t,e){return"';\n"+q(e)+"\n;__p+='"})+"';\n",n.variable||(t="with(obj||{}){\n"+t+"}\n");var t="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+t+"return __p;\n",r=new Function(n.variable||"obj","_",t);return e?r(e,_):(e=function(t){return r.call(this,t,_)},e.source="function("+(n.variable||"obj")+"){\n"+t+"}",e)},_.chain=function(t){return _(t).chain()};var M=function(t){this._wrapped=t};_.prototype=M.prototype;var T=function(t,e){return e?_(t).chain():t},N=function(t,e){M.prototype[t]=function(){var t=a.call(arguments);return s.call(t,this._wrapped),T(e.apply(_,t),this._chain)}};_.mixin(_),x("pop,push,reverse,shift,sort,splice,unshift".split(","),function(t){var e=i[t];M.prototype[t]=function(){var n=this._wrapped;e.apply(n,arguments);var r=n.length;return("shift"==t||"splice"==t)&&0===r&&delete n[0],T(n,this._chain)}}),x(["concat","join","slice"],function(t){var e=i[t];M.prototype[t]=function(){return T(e.apply(this._wrapped,arguments),this._chain)}}),M.prototype.chain=function(){return this._chain=!0,this},M.prototype.value=function(){return this._wrapped}}.call(window),define("libs/underscore-min",function(){}),define("Underscore",["!libs/underscore-min"],function(){return window._}),function(){var t,e=this,n=e.Backbone,r=Array.prototype.slice,i=Array.prototype.splice;t="undefined"!=typeof exports?exports:e.Backbone={},t.VERSION="0.9.2";var o=e._;!o&&"undefined"!=typeof require&&(o=require("underscore"));var a=e.jQuery||e.Zepto||e.ender;t.setDomLibrary=function(t){a=t},t.noConflict=function(){return e.Backbone=n,this},t.emulateHTTP=!1,t.emulateJSON=!1;var s=/\s+/,u=t.Events={on:function(t,e,n){var r,i,o,a,u;if(!e)return this;for(t=t.split(s),r=this._callbacks||(this._callbacks={});i=t.shift();)o=(u=r[i])?u.tail:{},o.next=a={},o.context=n,o.callback=e,r[i]={tail:a,next:u?u.next:o};return this},off:function(t,e,n){var r,i,a,u,c,l;if(i=this._callbacks){if(!t&&!e&&!n)return delete this._callbacks,this;for(t=t?t.split(s):o.keys(i);r=t.shift();)if(a=i[r],delete i[r],a&&(e||n))for(u=a.tail;(a=a.next)!==u;)c=a.callback,l=a.context,(e&&c!==e||n&&l!==n)&&this.on(r,c,l);return this}},trigger:function(t){var e,n,i,o,a,u;if(!(i=this._callbacks))return this;for(a=i.all,t=t.split(s),u=r.call(arguments,1);e=t.shift();){if(n=i[e])for(o=n.tail;(n=n.next)!==o;)n.callback.apply(n.context||this,u);if(n=a)for(o=n.tail,e=[e].concat(u);(n=n.next)!==o;)n.callback.apply(n.context||this,e)}return this}};u.bind=u.on,u.unbind=u.off;var c=t.Model=function(t,e){var n;t||(t={}),e&&e.parse&&(t=this.parse(t)),(n=k(this,"defaults"))&&(t=o.extend({},n,t)),e&&e.collection&&(this.collection=e.collection),this.attributes={},this._escapedAttributes={},this.cid=o.uniqueId("c"),this.changed={},this._silent={},this._pending={},this.set(t,{silent:!0}),this.changed={},this._silent={},this._pending={},this._previousAttributes=o.clone(this.attributes),this.initialize.apply(this,arguments)};o.extend(c.prototype,u,{changed:null,_silent:null,_pending:null,idAttribute:"id",initialize:function(){},toJSON:function(){return o.clone(this.attributes)},get:function(t){return this.attributes[t]},escape:function(t){var e;return(e=this._escapedAttributes[t])?e:(e=this.get(t),this._escapedAttributes[t]=o.escape(null==e?"":""+e))},has:function(t){return null!=this.get(t)},set:function(t,e,n){var r,i;if(o.isObject(t)||null==t?(r=t,n=e):(r={},r[t]=e),n||(n={}),!r)return this;if(r instanceof c&&(r=r.attributes),n.unset)for(i in r)r[i]=void 0;if(!this._validate(r,n))return!1;this.idAttribute in r&&(this.id=r[this.idAttribute]);var e=n.changes={},a=this.attributes,s=this._escapedAttributes,u=this._previousAttributes||{};for(i in r)t=r[i],(!o.isEqual(a[i],t)||n.unset&&o.has(a,i))&&(delete s[i],(n.silent?this._silent:e)[i]=!0),n.unset?delete a[i]:a[i]=t,o.isEqual(u[i],t)&&o.has(a,i)==o.has(u,i)?(delete this.changed[i],delete this._pending[i]):(this.changed[i]=t,n.silent||(this._pending[i]=!0));return n.silent||this.change(n),this},unset:function(t,e){return(e||(e={})).unset=!0,this.set(t,null,e)},clear:function(t){return(t||(t={})).unset=!0,this.set(o.clone(this.attributes),t)},fetch:function(e){var e=e?o.clone(e):{},n=this,r=e.success;return e.success=function(t,i,o){return n.set(n.parse(t,o),e)?(r&&r(n,t),void 0):!1},e.error=t.wrapError(e.error,n,e),(this.sync||t.sync).call(this,"read",this,e)},save:function(e,n,r){var i,a;if(o.isObject(e)||null==e?(i=e,r=n):(i={},i[e]=n),r=r?o.clone(r):{},r.wait){if(!this._validate(i,r))return!1;a=o.clone(this.attributes)}if(e=o.extend({},r,{silent:!0}),i&&!this.set(i,r.wait?e:r))return!1;var s=this,u=r.success;return r.success=function(t,e,n){return e=s.parse(t,n),r.wait&&(delete r.wait,e=o.extend(i||{},e)),s.set(e,r)?(u?u(s,t):s.trigger("sync",s,t,r),void 0):!1},r.error=t.wrapError(r.error,s,r),n=this.isNew()?"create":"update",n=(this.sync||t.sync).call(this,n,this,r),r.wait&&this.set(a,e),n},destroy:function(e){var e=e?o.clone(e):{},n=this,r=e.success,i=function(){n.trigger("destroy",n,n.collection,e)};if(this.isNew())return i(),!1;e.success=function(t){e.wait&&i(),r?r(n,t):n.trigger("sync",n,t,e)},e.error=t.wrapError(e.error,n,e);var a=(this.sync||t.sync).call(this,"delete",this,e);return e.wait||i(),a},url:function(){var t=k(this,"urlRoot")||k(this.collection,"url")||E();return this.isNew()?t:t+("/"==t.charAt(t.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(t){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},change:function(t){t||(t={});var e=this._changing;this._changing=!0;for(var n in this._silent)this._pending[n]=!0;var r=o.extend({},t.changes,this._silent);this._silent={};for(n in r)this.trigger("change:"+n,this,this.get(n),t);if(e)return this;for(;!o.isEmpty(this._pending);){this._pending={},this.trigger("change",this,t);for(n in this.changed)!this._pending[n]&&!this._silent[n]&&delete this.changed[n];this._previousAttributes=o.clone(this.attributes)}return this._changing=!1,this},hasChanged:function(t){return arguments.length?o.has(this.changed,t):!o.isEmpty(this.changed)},changedAttributes:function(t){if(!t)return this.hasChanged()?o.clone(this.changed):!1;var e,n,r=!1,i=this._previousAttributes;for(n in t)o.isEqual(i[n],e=t[n])||((r||(r={}))[n]=e);return r},previous:function(t){return arguments.length&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return o.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},_validate:function(t,e){if(e.silent||!this.validate)return!0;var t=o.extend({},this.attributes,t),n=this.validate(t,e);return n?(e&&e.error?e.error(this,n,e):this.trigger("error",this,n,e),!1):!0}});var l=t.Collection=function(t,e){e||(e={}),e.model&&(this.model=e.model),e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,{silent:!0,parse:e.parse})};o.extend(l.prototype,u,{model:c,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},add:function(t,e){var n,r,a,s,u,c={},l={},f=[];for(e||(e={}),t=o.isArray(t)?t.slice():[t],n=0,r=t.length;r>n;n++){if(!(a=t[n]=this._prepareModel(t[n],e)))throw Error("Can't add an invalid model to a collection");s=a.cid,u=a.id,c[s]||this._byCid[s]||null!=u&&(l[u]||this._byId[u])?f.push(n):c[s]=l[u]=a}for(n=f.length;n--;)t.splice(f[n],1);for(n=0,r=t.length;r>n;n++)(a=t[n]).on("all",this._onModelEvent,this),this._byCid[a.cid]=a,null!=a.id&&(this._byId[a.id]=a);if(this.length+=r,i.apply(this.models,[null!=e.at?e.at:this.models.length,0].concat(t)),this.comparator&&this.sort({silent:!0}),e.silent)return this;for(n=0,r=this.models.length;r>n;n++)c[(a=this.models[n]).cid]&&(e.index=n,a.trigger("add",a,this,e));return this},remove:function(t,e){var n,r,i,a;for(e||(e={}),t=o.isArray(t)?t.slice():[t],n=0,r=t.length;r>n;n++)(a=this.getByCid(t[n])||this.get(t[n]))&&(delete this._byId[a.id],delete this._byCid[a.cid],i=this.indexOf(a),this.models.splice(i,1),this.length--,e.silent||(e.index=i,a.trigger("remove",a,this,e)),this._removeReference(a));return this},push:function(t,e){return t=this._prepareModel(t,e),this.add(t,e),t},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t),e},unshift:function(t,e){return t=this._prepareModel(t,e),this.add(t,o.extend({at:0},e)),t},shift:function(t){var e=this.at(0);return this.remove(e,t),e},get:function(t){return null==t?void 0:this._byId[null!=t.id?t.id:t]},getByCid:function(t){return t&&this._byCid[t.cid||t]},at:function(t){return this.models[t]},where:function(t){return o.isEmpty(t)?[]:this.filter(function(e){for(var n in t)if(t[n]!==e.get(n))return!1;return!0})},sort:function(t){if(t||(t={}),!this.comparator)throw Error("Cannot sort a set without a comparator");var e=o.bind(this.comparator,this);return 1==this.comparator.length?this.models=this.sortBy(e):this.models.sort(e),t.silent||this.trigger("reset",this,t),this},pluck:function(t){return o.map(this.models,function(e){return e.get(t)})},reset:function(t,e){t||(t=[]),e||(e={});for(var n=0,r=this.models.length;r>n;n++)this._removeReference(this.models[n]);return this._reset(),this.add(t,o.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),this},fetch:function(e){e=e?o.clone(e):{},void 0===e.parse&&(e.parse=!0);var n=this,r=e.success;return e.success=function(t,i,o){n[e.add?"add":"reset"](n.parse(t,o),e),r&&r(n,t)},e.error=t.wrapError(e.error,n,e),(this.sync||t.sync).call(this,"read",this,e)},create:function(t,e){var n=this,e=e?o.clone(e):{},t=this._prepareModel(t,e);if(!t)return!1;e.wait||n.add(t,e);var r=e.success;return e.success=function(i,o){e.wait&&n.add(i,e),r?r(i,o):i.trigger("sync",t,o,e)},t.save(null,e),t},parse:function(t){return t},chain:function(){return o(this.models).chain()},_reset:function(){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel:function(t,e){return e||(e={}),t instanceof c?t.collection||(t.collection=this):(e.collection=this,t=new this.model(t,e),t._validate(t.attributes,e)||(t=!1)),t},_removeReference:function(t){this==t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,n,r){("add"==t||"remove"==t)&&n!=this||("destroy"==t&&this.remove(e,r),e&&t==="change:"+e.idAttribute&&(delete this._byId[e.previous(e.idAttribute)],this._byId[e.id]=e),this.trigger.apply(this,arguments))}}),o.each("forEach,each,map,reduce,reduceRight,find,detect,filter,select,reject,every,all,some,any,include,contains,invoke,max,min,sortBy,sortedIndex,toArray,size,first,initial,rest,last,without,indexOf,shuffle,lastIndexOf,isEmpty,groupBy".split(","),function(t){l.prototype[t]=function(){return o[t].apply(o,[this.models].concat(o.toArray(arguments)))}});var f=t.Router=function(t){t||(t={}),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},h=/:\w+/g,d=/\*\w+/g,p=/[-[\]{}()+?.,\\^$|#\s]/g;o.extend(f.prototype,u,{initialize:function(){},route:function(e,n,r){return t.history||(t.history=new g),o.isRegExp(e)||(e=this._routeToRegExp(e)),r||(r=this[n]),t.history.route(e,o.bind(function(i){i=this._extractParameters(e,i),r&&r.apply(this,i),this.trigger.apply(this,["route:"+n].concat(i)),t.history.trigger("route",this,n,i)},this)),this},navigate:function(e,n){t.history.navigate(e,n)},_bindRoutes:function(){if(this.routes){var t,e=[];for(t in this.routes)e.unshift([t,this.routes[t]]);t=0;for(var n=e.length;n>t;t++)this.route(e[t][0],e[t][1],this[e[t][1]])}},_routeToRegExp:function(t){return t=t.replace(p,"\\$&").replace(h,"([^/]+)").replace(d,"(.*?)"),RegExp("^"+t+"$")},_extractParameters:function(t,e){return t.exec(e).slice(1)}});var g=t.History=function(){this.handlers=[],o.bindAll(this,"checkUrl")},m=/^[#\/]/,v=/msie [\w.]+/;g.started=!1,o.extend(g.prototype,u,{interval:50,getHash:function(t){return(t=(t?t.location:window.location).href.match(/#(.*)$/))?t[1]:""},getFragment:function(t,e){if(null==t)if(this._hasPushState||e){var t=window.location.pathname,n=window.location.search;n&&(t+=n)}else t=this.getHash();return t.indexOf(this.options.root)||(t=t.substr(this.options.root.length)),t.replace(m,"")},start:function(t){if(g.started)throw Error("Backbone.history has already been started");g.started=!0,this.options=o.extend({},{root:"/"},this.options,t),this._wantsHashChange=!1!==this.options.hashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.options.pushState||!window.history||!window.history.pushState);var t=this.getFragment(),e=document.documentMode;return(e=v.exec(navigator.userAgent.toLowerCase())&&(!e||7>=e))&&(this.iframe=a('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(t)),this._hasPushState?a(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!e?a(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=t,t=window.location,e=t.pathname==this.options.root,this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!e?(this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&e&&t.hash&&(this.fragment=this.getHash().replace(m,""),window.history.replaceState({},document.title,t.protocol+"//"+t.host+this.options.root+this.fragment)),this.options.silent?void 0:this.loadUrl())},stop:function(){a(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),g.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(){var t=this.getFragment();return t==this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe))),t==this.fragment?!1:(this.iframe&&this.navigate(t),this.loadUrl()||this.loadUrl(this.getHash()),void 0)},loadUrl:function(t){var e=this.fragment=this.getFragment(t);return o.any(this.handlers,function(t){return t.route.test(e)?(t.callback(e),!0):void 0})},navigate:function(t,e){if(!g.started)return!1;e&&!0!==e||(e={trigger:e});var n=(t||"").replace(m,"");this.fragment!=n&&(this._hasPushState?(0!=n.indexOf(this.options.root)&&(n=this.options.root+n),this.fragment=n,window.history[e.replace?"replaceState":"pushState"]({},document.title,n)):this._wantsHashChange?(this.fragment=n,this._updateHash(window.location,n,e.replace),this.iframe&&n!=this.getFragment(this.getHash(this.iframe))&&(e.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,n,e.replace))):window.location.assign(this.options.root+t),e.trigger&&this.loadUrl(t))},_updateHash:function(t,e,n){n?t.replace(t.toString().replace(/(javascript:|#).*$/,"")+"#"+e):t.hash=e}});var y=t.View=function(t){this.cid=o.uniqueId("view"),this._configure(t||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},b=/^(\S+)\s*(.*)$/,w="model,collection,el,id,attributes,className,tagName".split(",");o.extend(y.prototype,u,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this},make:function(t,e,n){return t=document.createElement(t),e&&a(t).attr(e),n&&a(t).html(n),t},setElement:function(t,e){return this.$el&&this.undelegateEvents(),this.$el=t instanceof a?t:a(t),this.el=this.$el[0],!1!==e&&this.delegateEvents(),this},delegateEvents:function(t){if(t||(t=k(this,"events"))){this.undelegateEvents();for(var e in t){var n=t[e];if(o.isFunction(n)||(n=this[t[e]]),!n)throw Error('Method "'+t[e]+'" does not exist');var r=e.match(b),i=r[1],r=r[2],n=o.bind(n,this),i=i+(".delegateEvents"+this.cid);""===r?this.$el.bind(i,n):this.$el.delegate(r,i,n)}}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(t){this.options&&(t=o.extend({},this.options,t));for(var e=0,n=w.length;n>e;e++){var r=w[e];t[r]&&(this[r]=t[r])}this.options=t},_ensureElement:function(){if(this.el)this.setElement(this.el,!1);else{var t=k(this,"attributes")||{};this.id&&(t.id=this.id),this.className&&(t["class"]=this.className),this.setElement(this.make(this.tagName,t),!1)}}}),c.extend=l.extend=f.extend=y.extend=function(t,e){var n=S(this,t,e);return n.extend=this.extend,n};var _={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};t.sync=function(e,n,r){var i=_[e];r||(r={});var s={type:i,dataType:"json"};return r.url||(s.url=k(n,"url")||E()),r.data||!n||"create"!=e&&"update"!=e||(s.contentType="application/json",s.data=JSON.stringify(n.toJSON())),t.emulateJSON&&(s.contentType="application/x-www-form-urlencoded",s.data=s.data?{model:s.data}:{}),!t.emulateHTTP||"PUT"!==i&&"DELETE"!==i||(t.emulateJSON&&(s.data._method=i),s.type="POST",s.beforeSend=function(t){t.setRequestHeader("X-HTTP-Method-Override",i)}),"GET"!==s.type&&!t.emulateJSON&&(s.processData=!1),a.ajax(o.extend(s,r))},t.wrapError=function(t,e,n){return function(r,i){i=r===e?i:r,t?t(e,i,n):e.trigger("error",e,i,n)}};var x=function(){},S=function(t,e,n){var r;return r=e&&e.hasOwnProperty("constructor")?e.constructor:function(){t.apply(this,arguments)},o.extend(r,t),x.prototype=t.prototype,r.prototype=new x,e&&o.extend(r.prototype,e),n&&o.extend(r,n),r.prototype.constructor=r,r.__super__=t.prototype,r},k=function(t,e){return t&&t[e]?o.isFunction(t[e])?t[e]():t[e]:null},E=function(){throw Error('A "url" property or function must be specified')}}.call(window),define("libs/backbone-min",function(){}),define("Backbone",["!libs/backbone-min"],function(){return window.Backbone}),define("Leaflet",[],function(){return window.L}),define("models/mapState",["Backbone"],function(t){return t.Model.extend({defaults:{lat:59.95,lon:30.3,z:10},initialize:function(){this.fetch()},fetch:function(){if(window.localStorage){var t=window.localStorage;t.lon&&t.lat&&t.z&&this.set({lon:t.lon,lat:t.lat,z:t.z})}},save:function(){if(window.localStorage){var t=window.localStorage;t.lon=this.get("lon"),t.lat=this.get("lat"),t.z=this.get("z")}}})}),define("models/mapStateItem",["models/mapState"],function(t){return new t}),Backbone.EventBroker=Backbone.EventBroker||function(){var t={},e=function(t,e,n,r){!e&&t.interests&&(e=t,t=t.interests);
for(var i in t)t.hasOwnProperty(i)&&n[r](i,e[t[i]],e);return n},n={register:function(t,n){return t||n?e(t,n,this,"on"):this},unregister:function(t,n){return t||n?e(t,n,this,"off"):this}};return _.extend({namespace:"",get:function(e){return void 0===t[e]&&(t[e]=_.extend({namespace:e},Backbone.Events,n)),t[e]},has:function(e){return void 0!==t[e]},destroy:function(e){if(e)t[e]&&(t[e].off(),delete t[e]);else for(e in t)t.hasOwnProperty(e)&&this.destroy(e);return this}},Backbone.Events,n)}(),define("BackboneEventBroker",["Backbone"],function(t){return function(){var e;return e||t.BackboneEventBroker}}(this)),define("EventBroker",["Backbone","BackboneEventBroker"],function(t){return t.EventBroker}),define("models/leafletMapObject",["Backbone","jQuery"],function(t){return new(t.Model.extend({my_map:null,initialize:function(){},setMap:function(t){this.my_map=t},getMap:function(){return this.my_map}}))}),define("views/mapView",["Backbone","jQuery","Leaflet","models/mapStateItem","EventBroker","models/leafletMapObject"],function(t,e,n,r,i,o){return t.View.extend({model:r,interests:{"map:setCenter":"mapSetCenterSignalHandler"},initialize:function(){var t=this.model;t.fetch(),t.on("change",t.save,t);var r=n.map("map",{center:[t.get("lat"),t.get("lon")],zoom:t.get("z")});o.setMap(r),r.on("moveend",function(){if(!t._update_from_change){var e=r.getCenter();t._update_from_map=!0,t.set({lon:e.lng,lat:e.lat,z:r.getZoom()}),delete t._update_from_map}}),t.on("change",function(){t._update_from_map||(t._update_from_change=!0,r.setView([t.get("lat"),t.get("lon")],t.get("z")),delete t._update_from_change)}),e("#map-page").bind("pageshow",function(){setTimeout(function(){r.invalidateSize()},0)}),i.register(this),n.control.scale().addTo(r)},mapSetCenterSignalHandler:function(t){this.model.set(t)}})}),define("detect/fullScreen",[],function(){return{hasFullScreenAPI:function(t){return!!(t.requestFullscreen||t.webkitRequestFullScreen||t.mozRequestFullScreen)},fullScreen:function(t){t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullScreen?t.webkitRequestFullScreen():t.mozRequestFullScreen&&t.mozRequestFullScreen()},exitFullScreen:function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()}}}),define("models/settingsItem",["Backbone","jQuery"],function(t){var e=new(t.Model.extend({defaults:{fullScreen:!1},initialize:function(){},save:function(){localStorage.settings=JSON.stringify(this.toJSON())},fetch:function(){localStorage.settings&&this.set(JSON.parse(localStorage.settings))}}));return e.fetch(),e.on("change",e.save,e),e}),define("views/fullScreenView",["Backbone","jQuery","detect/fullScreen","models/settingsItem"],function(t,e,n,r){return t.View.extend({events:{"change #full-screen-switcher":"fullScreenToggleHandler"},initialize:function(){this.setElement(e("#full-screen-switcher").parent()[0]),n.hasFullScreenAPI(e("body")[0])&&e("body").addClass("has-fullscreen"),this.render()},render:function(){this.$("#full-screen-switcher").val(r.get("fullScreen")?"on":"off").slider("refresh")},fullScreenToggleHandler:function(){var t=e("#full-screen-switcher"),n=t.val();switch(n){case"on":this.goFullScreen();break;case"off":this.exitFullScreen()}return r.set("fullScreen","on"==n),!0},goFullScreen:function(){alert("go!"),n.fullScreen(e("html").addClass("fullScreen")[0])},exitFullScreen:function(){n.exitFullScreen(),e("html").removeClass("fullScreen")}})}),define("models/currentPositionItem",["Backbone"],function(t){return new t.Model}),define("functions/distanceMeters",["Leaflet"],function(t){return function(e,n){var r=new t.LatLng(e.lat,e.lon);return r.distanceTo([n.lat,n.lon])}}),define("views/updateLocation",["Backbone","jQuery","EventBroker","models/currentPositionItem","functions/distanceMeters","models/mapStateItem"],function(t,e,n,r,i,o){return t.View.extend({model:r,initialize:function(){var t=this;navigator.geolocation&&navigator.geolocation.watchPosition(function(e){setTimeout(function(){t.model.set({lon:e.coords.longitude,lat:e.coords.latitude})},0)},function(){},{enableHighAccuracy:!0,maximumAge:0}),this.model.on("change",function(){var e=i(t.model.toJSON(),o.toJSON());if(e>20){var r=t.model.toJSON();r.z=18,n.trigger("map:setCenter",r)}})}})}),define("views/currentPositionMarkerView",["Backbone","Leaflet","models/leafletMapObject","models/currentPositionItem"],function(t,e,n,r){return t.View.extend({my_marker:null,initialize:function(){var t=n.getMap(),i=this;r.on("change",function(){if(r.get("lat")){var n=[r.get("lat"),r.get("lon")];i.my_marker?i.my_marker.setLatLng(n).update():i.my_marker=new e.Marker(n).addTo(t)}})}})}),define("views/baseLayerView",["Backbone","Leaflet","models/leafletMapObject"],function(t,e,n){return t.View.extend({initialize:function(){var t=n.getMap();e.tileLayer("http://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}).addTo(t)}})}),function(){function t(t,e,n){n=c;var r="__p+='"+t.replace(d,function(t){return"\\"+f[t]}).replace(n.escape||l,function(t,e){return"'+_.escape("+g(e)+")+'"}).replace(n.interpolate||l,function(t,e){return"'+("+g(e)+")+'"}).replace(n.evaluate||l,function(t,e){return"';"+g(e)+";__p+='"})+"';";n.variable||(r="with(obj||{}){"+r+"}"),r="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};"+r+"return __p;";var i=new Function(n.variable||"obj","_",r);if(e)return i(e,_);var o=function(t){return i.call(this,t,_)};return o.source="function("+(n.variable||"obj")+"){"+r+"}",o}var e=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],n=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,r=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,i="undefined"!=typeof location&&location.href,o=i&&location.protocol&&location.protocol.replace(/\:/,""),a=i&&location.hostname,s=i&&(location.port||void 0),u=[],c={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},l=/.^/,f={"\\":"\\","'":"'",r:"\r",n:"\n",t:"	",u2028:"\u2028",u2029:"\u2029"};for(var h in f)f[f[h]]=h;var d=/\\|'|\r|\n|\t|\u2028|\u2029/g,p=/\\(\\|'|r|n|t|u2028|u2029)/g,g=function(t){return t.replace(p,function(t,e){return f[e]})};define("tpl",[],function(){var c,l,f;return"undefined"!=typeof window&&window.navigator&&window.document?l=function(t,e){var n=c.createXhr();n.open("GET",t,!0),n.onreadystatechange=function(){4===n.readyState&&e(n.responseText)},n.send(null)}:"undefined"!=typeof process&&process.versions&&process.versions.node?(f=require.nodeRequire("fs"),l=function(t,e){e(f.readFileSync(t,"utf8"))}):"undefined"!=typeof Packages&&(l=function(t,e){var n,r,i="utf-8",o=new java.io.File(t),a=java.lang.System.getProperty("line.separator"),s=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(o),i)),u="";try{for(n=new java.lang.StringBuffer,r=s.readLine(),r&&r.length()&&65279===r.charAt(0)&&(r=r.substring(1)),n.append(r);null!==(r=s.readLine());)n.append(a),n.append(r);u=String(n.toString())}finally{s.close()}e(u)}),c={version:"1.0.0",strip:function(t){if(t){t=t.replace(n,"");var e=t.match(r);e&&(t=e[1])}else t="";return t},jsEscape:function(t){return t.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")},createXhr:function(){var t,n,r;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;for(n=0;3>n;n++){r=e[n];try{t=new ActiveXObject(r)}catch(i){}if(t){e=[r];break}}if(!t)throw new Error("createXhr(): XMLHttpRequest not available");return t},get:l,parseName:function(t){var e=!1,n=t.indexOf("."),r=t.substring(0,n),i=t.substring(n+1,t.length);return n=i.indexOf("!"),-1!==n&&(e=i.substring(n+1,i.length),e="strip"===e,i=i.substring(0,n)),{moduleName:r,ext:i,strip:e}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(t,e,n,r){var i,o,a,s=c.xdRegExp.exec(t);return s?(i=s[2],o=s[3],o=o.split(":"),a=o[1],o=o[0],!(i&&i!==e||o&&o!==n||(a||o)&&a!==r)):!0},finishLoad:function(e,n,r,i,o){r=n?c.strip(r):r;var a=t(r),s=a.source;o.isBuild&&o.inlineText&&(u[e]=s),i(a)},load:function(t,e,n,r){var u=c.parseName(t),l=u.moduleName+"."+u.ext,f=e.toUrl(l),h=r&&r.text&&r.text.useXhr||c.useXhr;!i||h(f,o,a,s)?c.get(f,function(e){c.finishLoad(t,u.strip,e,n,r)}):e([l],function(t){c.finishLoad(u.moduleName+"."+u.ext,u.strip,t,n,r)})},write:function(t,e,n){if(e in u){var r=u[e];n('define("'+t+"!"+e+'", function() { return '+r+"; });\n")}},writeFile:function(t,e,n,r,i){var o=c.parseName(e),a=o.moduleName+"."+o.ext,s=n.toUrl(o.moduleName+"."+o.ext)+".js";c.load(a,n,function(){var e=function(t){return r(s,t)};e.asModule=function(t,e){return r.asModule(t,s,e)},c.write(t,a,e,i)},i)}}})}(),define("tpl!templates/request.xml",function(){return function(obj){var __p="";with(obj||{})__p+='<?xml version="1.0" encoding="UTF-8"?><osm-script><query type="way"> <has-kv k="building" /> <has-kv k="building:levels" modv="not" regv="[0-9]" /> <bbox-query s="'+south+'" w="'+west+'" n="'+north+'" e="'+east+'"/><!--this is auto-completed with the current map view coordinates.--> </query> <!-- added by auto repair --> <union> <item/> <recurse type="down"/> </union> <print mode="meta"/></osm-script>\n';return __p}}),define("functions/osm2geo",[],function(){var t=function(t){function e(t){var e=new Array;return e.push(parseFloat(t.attr("minlon"))),e.push(parseFloat(t.attr("minlat"))),e.push(parseFloat(t.attr("maxlon"))),e.push(parseFloat(t.attr("maxlat"))),e}function n(t){var e={},n=$(t).find("tag");return n.each(function(t,n){e[$(n).attr("k")]=$(n).attr("v")}),e}function r(t,e){return{geometry:{type:e,coordinates:[]},type:"Feature",properties:n(t)}}var i=jQuery(t),o={type:"FeatureCollection",features:[]};o.bbox=e(i.find("bounds"));var a=$("way",i);a.each(function(t,e){var n=new Object,a=$(e).find("nd");$(a).last().attr("ref")===$(a).first().attr("ref")?(n=r(e,"Polygon"),n.geometry.coordinates.push([])):n=r(e,"LineString"),a.each(function(t,e){var r=i.find("node[id='"+$(e).attr("ref")+"']"),o=[parseFloat(r.attr("lon")),parseFloat(r.attr("lat"))];"Polygon"===n.geometry.type?n.geometry.coordinates[0].push(o):n.geometry.coordinates.push(o)}),o.features.push(n)});var s=$("node:has('tag')",i);return s.each(function(t,e){var n=r(e,"Point");n.geometry.coordinates.push(parseFloat($(e).attr("lon"))),n.geometry.coordinates.push(parseFloat($(e).attr("lat"))),o.features.push(n)}),o};return t}),define("views/dataLayerView",["Backbone","Leaflet","models/leafletMapObject","models/mapStateItem","tpl!templates/request.xml","functions/osm2geo"],function(t,e,n,r,i,o){return t.View.extend({my_layer:null,my_selected_layer:null,my_request_bounds:null,initialize:function(){r.on("change",this.updateLayerIfNeed,this),this.updateLayerIfNeed()},updateLayerIfNeed:function(){var t=this,e=n.getMap(),r=e.getBounds();if(!this.my_request_bounds||!this.my_request_bounds.contains(r)){var a=r.pad(.3),s=i({south:a.getSouth(),north:a.getNorth(),east:a.getEast(),west:a.getWest()});this.my_request_bounds=a,$.ajax({type:"POST",url:"http://overpass-api.de/api/interpreter",data:s,dataType:"html",success:function(e){var n=o(e);t.render(n)}})}},render:function(t){var r=n.getMap(),i=this;this.my_layer&&r.removeLayer(this.my_layer);var o=e.geoJson(t,{onEachFeature:function(t,e){e.on("click",function(){i.my_selected_layer&&i.my_selected_layer.setStyle(i.my_selected_layer.originalStyle),e.originalStyle=e.options,e.setStyle({color:"#0000ff",weight:8}),i.my_selected_layer=e})}}).addTo(r);this.my_layer=o}})}),define("app",["views/mapView","views/fullScreenView","views/updateLocation","views/currentPositionMarkerView","views/baseLayerView","views/dataLayerView"],function(t,e,n,r,i,o){var a=function(){new t,new i,new o,new e,new n,new r};return{initialize:a}}),require.config({baseUrl:"js",paths:{tpl:"libs/tpl",models:"models",views:"views",jQuery:"jQuery.from.window",Leaflet:"Leaflet.from.window",Backbone:"libs/backbone",Underscore:"libs/underscore",EventBroker:"libs/event-broker-debug",BackboneEventBroker:"libs/backbone-eventbroker",templates:"../templates"},shim:{Underscore:{deps:["jQuery"],exports:"Underscore"},Backbone:{deps:["Underscore","jQuery"],exports:"Backbone"},BackboneEventBroker:{deps:["Backbone"],exports:"BackboneEventBroker"}}}),require(["app","jQuery"],function(t,e){e(t.initialize)}),define("main",function(){})});